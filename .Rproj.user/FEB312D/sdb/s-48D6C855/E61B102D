{
    "contents" : "\n\n\n# DO ALL STEPS BELOW TO DATASET EACH TIME #\n\n\n#Packages required\nlibrary(psych)\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(Hmisc)\nlibrary(qcc)\nlibrary(igraph)\nlibrary(reshape)\nlibrary(data.table)\nlibrary(MASS)\nlibrary(splitstackshape)\nlibrary(xlsx)\nlibrary(GGally)\nlibrary(lme4)\nlibrary(reshape2)\nlibrary(compiler)\nlibrary(parallel)\nlibrary(boot)\nlibrary(FactoMineR)\nlibrary(lsr)\nlibrary(tidyr)\nlibrary(rmarkdown)\nlibrary(epitools)\nlibrary(cmprsk)\n\n#Load dataset:\nsetwd(\"/Volumes/SourceFiles/Data_derived/URMC_ICU_Data/Kristen\")\nICU_Official <- read.csv(\"ICU_v4_12312015.csv\",header=TRUE,as.is=TRUE)\n\n#Load Diagnosis Groups:\nICU_Diagnosis <- read.csv(\"ICU_SMH_Diagnosis_Groups_FINAL.csv\",header=TRUE,as.is=TRUE)\n\n#Omit admit IDs of pts that should be excluded bc of pediatric, etc.:\nICU_Official <- ICU_Official[!(ICU_Official$ADMIT_ID %in% c(468116, 468468, 469467, 470162, 472646, \n                                                            492575, 524961, 545962, 549317, 579127, \n                                                            612553, 613116, 618405, 625733,\n                                                            626499, 666388, 672098, 676640, 686190, \n                                                            686682, 696198, 699524)), ]\n\n#Find out how many pts died during first ICU admission:\nattach(ICU_Official)\nfreq_tab <- table(CAT_ICU_ANY.2,CAT_SURV_FIRST_ICU.2)\nftable(freq_tab)\n#CAT_SURV_FIRST_ICU.2                  0    1\n#CAT_ICU_ANY.2                               \n#0                                     0    0\n#1                                   620 4756\n#Therefore, we need to omit the 620 patients who died in their first ICU visit\nICU_Official <- ICU_Official[!(ICU_Official$CAT_SURV_FIRST_ICU.2 == 0 & ICU_Official$CAT_ICU_ANY.2 == 1), ]\n\n#Omit STDU ONLY pts:\nICU_Official <- ICU_Official[!(ICU_Official$CAT_ICU_ANY.2 == 0),]\n\n#Merge ICU_Official and ICU_Diagnosis:\nICU_Official <- merge(ICU_Official, ICU_Diagnosis, by = \"ADMIT_ID\")\n#Added in extras and diagnosis variables:\n#[663] \"DX_54\"                                                   \"MI_DX\"                                                  \n#[665] \"CHF_DX\"                                                  \"VASCUL1_DX\"                                             \n#[667] \"CVD_DX\"                                                  \"COPD_DX\"                                                \n#[669] \"Asthma_DX\"                                               \"LIPID_DX\"                                               \n#[671] \"DIAB_DX\"                                                 \"RENAL_DX\"                                               \n#[673] \"CKD_DX\"                                                  \"LIVER_DX\"                                               \n#[675] \"HIV_DX\"                                                  \"Hep_DX\"                                                 \n#[677] \"CANCER_DX\"                                               \"Bleeding_DX\"                                            \n#[679] \"Resp_Fail_DX\"                                            \"Sepsis_DX\"                                              \n#[681] \"Vent\"                                                    \"Vent0_96\"                                               \n#[683] \"Vent96\"  \n\n#Create new variable for DISCHARGE = DEATH:\nICU_Official$DC_DEATH <- as.numeric(ICU_Official$DISCHARGE_DISPOSITION_1.x == \"zDC DEATH\")\n\n#-----------------------------------------------------------------------------------------------------------#\n\n########################### ALL PATIENTS #################################\n\n\n\n#View all variable names \ncolnames(ICU_Official)\n\n###DON'T NEED TO DO - JUST USE FOR REFERENCE\n#Deleting things we don't need to create dataset ICU_VARS:\nICU_VARS_OFFICIAL <- ICU_Official[,names(ICU_Official) %in% c(\"ADMIT_ID\", \"PATIENT_NUM\", \"AGE_ON_ADMISSION\", \n                                                              \"MARITAL_CD\", \"ETHNIC_CD\", \"SEX_CD\", \"GRAND_TOTAL\",\n                                                              \"DISCHARGE_DISPOSITION_1\", \"TOT_LOS\", \"ICU_ADMIT\",\n                                                              \"CAT_ICU_AND_STDU.2\", \"CAT_STDU_ANY.2\", \"CAT_ICU_ANY.2\", \n                                                              \"CAT_LIN_LOOP.2\", \"Total.transfers.2\", \"time.to.first.STDU.loop.2\",\n                                                              \"CAT_SURV_FIRST_ICU.2\", \"CAT_SURV_FIRST_STDU.2\", \"time.to.first.ICU.loop.2\",\n                                                              \"Total.ICU.Time.2\", \"Total.STDU.Time.2\", \"location.of.completed.first.STDU.loop.2\",\n                                                              \"location.of.completed.first.ICU.loop.2\")] \n\n#Frequency table - Discharge Disposition vs. ICU Admit\nattach(ICU_Official)\nfreq_DISCHARGE_vs_ICUADMIT <- table(DISCHARGE_DISPOSITION_1.x,ICU_ADMIT)\nftable(freq_DISCHARGE_vs_ICUADMIT)  \n\n#Frequency table - Discharge Disposition vs. Linear/Looper\nattach(ICU_Official)\nfreq_DISCHARGE_vs_LINLOOP <- table(DISCHARGE_DISPOSITION_1.x,CAT_LIN_LOOP.2)\nftable(freq_DISCHARGE_vs_LINLOOP)\n#CAT_LIN_LOOP.2    0    1\n#DISCHARGE_DISPOSITION_1.x                         \n#zDC DEATH                                 102  210\n#zDC FED                                     2    1\n#zDC HHLTH                                1168  537\n#zDC HOME                                 1101  295\n#zDC HOSPICE                                84   45\n#zDC ICF                                     2    0\n#zDC LAMA                                   26    3\n#zDC LAW                                    20    6\n#zDC OTHER                                   5    0\n#zDC PSYU                                   38    6\n#zDC REHAB                                 199   76\n#zDC SNF                                   507  283\n#zDC STAC                                   22   17\n#zDC SWING                                   1    0\n\n#Frequency table - Sex vs. Linear/Looper\nattach(ICU_Official)\nfreq_SEX_vs_LINLOOP <- table(SEX_CD,CAT_LIN_LOOP.2)\nftable(freq_SEX_vs_LINLOOP)\n#CAT_LIN_LOOP.2           0    1\n#SEX_CD                         \n#F                     1304  601\n#M                     1973  878\n\n#Frequency table - Ethnicity vs. Linear/Looper\nattach(ICU_Official)\nfreq_ETHNICITY_vs_LINLOOP <- table(ETHNIC_CD,CAT_LIN_LOOP.2)\nftable(freq_ETHNICITY_vs_LINLOOP)\n#CAT_LIN_LOOP.2    0    1\n#ETHNIC_CD                         \n#AI                          5    1\n#AS                         32   17\n#BL                        449  185\n#MR                          9    2\n#OT                        108   56\n#UN                         16    4\n#WH                       2658 1214\n\n#Freq table for ICU only:\nattach(ICU_Official)\nfreq_ICU_vs_LINLOOP <- table(CAT_ICU_NO_STDU.2,CAT_LIN_LOOP.2)\nftable(freq_ICU_vs_LINLOOP)\n\nattach(ICU_Official)\nfreq_ICU_vs_Surv <- table(CAT_ICU_NO_STDU.2,CAT_SURV_FIRST_ICU.2)\nftable(freq_ICU_vs_Surv)\n\n\n\n#Freq table for ICU + STDU:\nattach(ICU_Official)\nfreq_ICU_STDU_vs_LINLOOP <- table(CAT_ICU_AND_STDU.2,CAT_LIN_LOOP.2)\nftable(freq_ICU_STDU_vs_LINLOOP)\n\nattach(ICU_Official)\nfreq_ICU_STDU_vs_Surv <- table(CAT_ICU_AND_STDU.2,CAT_SURV_FIRST_ICU.2)\nftable(freq_ICU_STDU_vs_Surv)\n\nattach(ICU_Official)\nfreq_ICU_STDU_vs_Surv2 <- table(CAT_ICU_AND_STDU.2,CAT_SURV_FIRST_STDU.2)\nftable(freq_ICU_STDU_vs_Surv2)\n\n\n#Freq table for ICU & Discharge disposition:\nattach(ICU_Official)\nfreq_ICU_Discharge <- table(DISCHARGE_DISPOSITION_1.x,CAT_ICU_NO_STDU.2)\nftable(freq_ICU_Discharge)\n#CAT_ICU_NO_STDU.2    0    1\n#DISCHARGE_DISPOSITION_1.x                            \n#zDC DEATH                                     92  220\n#zDC FED                                        1    2\n#zDC HHLTH                                    447 1258\n#zDC HOME                                     228 1168\n#zDC HOSPICE                                   35   94\n#zDC ICF                                        0    2\n#zDC LAMA                                       0   29\n#zDC LAW                                        4   22\n#zDC OTHER                                      0    5\n#zDC PSYU                                       4   40\n#zDC REHAB                                     66  209\n#zDC SNF                                      208  582\n#zDC STAC                                      11   28\n#zDC SWING                                      0    1\n\n#Freq table for ICU + STDU and Discharge:\nattach(ICU_Official)\nfreq_ICU_STDU_Discharge <- table(DISCHARGE_DISPOSITION_1.x,CAT_ICU_AND_STDU.2)\nftable(freq_ICU_STDU_Discharge)\n#CAT_ICU_AND_STDU.2                           0    1\n#DISCHARGE_DISPOSITION_1                             \n#zDC DEATH                                   471   92\n#zDC FED                                       6    1\n#zDC HHLTH                                  2816  447\n#zDC HOME                                   5514  228\n#zDC HOSPICE                                 199   35\n#zDC ICF                                       2    0\n#zDC LAMA                                     61    0\n#zDC LAW                                      34    4\n#zDC LTC                                       1    0\n#zDC OTHER                                     8    0\n#zDC PSYU                                     55    4\n#zDC REHAB                                   322   66\n#zDC SNF                                    1016  208\n#zDC STAC                                     39   11\n#zDC SWING                                     1    0\n\n#Median age for linear v looper:\nattach(ICU_Official)\nAge_Lin_Loop <- subset(AGE_ON_ADMISSION.x,CAT_LIN_LOOP.2 == 0)\nsummary(Age_Lin_Loop)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#18.00   46.00   60.00   57.98   72.00  104.00\nAge_Lin_Loop2 <- subset(AGE_ON_ADMISSION.x,CAT_LIN_LOOP.2 == 1)\nsummary(Age_Lin_Loop2)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#19.0    52.5    64.0    62.1    74.0    97.0 \n\n#Median table for Time to first ICU visit for ICU only:\nSURV_ICU_ICU_ONLY <- subset(Time.to.first.ICU.stay.2,CAT_ICU_NO_STDU.2 == \"1\")\nsummary(SURV_ICU_ICU_ONLY)\n#Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n#-3.7720   0.1628   0.3139   2.1580   0.7105 430.8000 \n\n#Median table for Time to first ICU visit for ICU + STDU:\nSURV_ICU_ICU_STDU <- subset(Time.to.first.ICU.stay.2,CAT_ICU_AND_STDU.2 == \"1\")\nsummary(SURV_ICU_ICU_STDU)\n#Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n#0.0000   0.2029   0.7674   3.8890   3.9470 202.9000\n\n#Median table for Time to first STDU visit for ICU + STDU:\nSURV_STDU_ICU_STDU <- subset(Time.to.first.STDU.stay.2,CAT_ICU_AND_STDU.2 == \"1\")\nsummary(SURV_STDU_ICU_STDU)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#0.0000  0.3143  1.7840  5.3100  5.5460 97.8500 \n\n#Median table for total time in ICU for ICU only:\nTime_in_ICU_ICU <- subset(Total.ICU.Time.2,CAT_ICU_NO_STDU.2 == \"1\")\nsummary(Time_in_ICU_ICU)\n#Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n#0.0007   1.2030   2.4630   6.0440   5.1300 344.7000\n\n#Median table for total time in ICU for ICU + STDU:\nTime_in_ICU_ICUSTDU <- subset(Total.ICU.Time.2,CAT_ICU_AND_STDU.2 == \"1\")\nsummary(Time_in_ICU_ICUSTDU)\n#Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n#0.00071   1.54600   3.04600   7.48400   7.23100 191.10000 \n\n#Median table for total time in STDU for ICU + STDU:\nTime_in_STDU_ICUSTDU <- subset(Total.STDU.Time.2,CAT_ICU_AND_STDU.2 == \"1\")\nsummary(Time_in_STDU_ICUSTDU)\n#Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n#0.00255   1.73900   3.70400   6.66800   7.35100 141.10000 \n\n#Median table for time to first loop in ICU for ICU only:\nTime_loop_ICU_ICU <- subset(time.to.first.ICU.loop.2,CAT_ICU_NO_STDU.2 == \"1\")\nsummary(Time_loop_ICU_ICU)\n#    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's \n#  0.0007   2.2640   5.3800  11.7200  11.5900 451.7000     2693 \n\n#Median table for time to first loop in ICU for ICU + STDU:\nTime_loop_ICU_ICUSTDU <- subset(time.to.first.ICU.loop.2,CAT_ICU_AND_STDU.2 == \"1\")\nsummary(Time_loop_ICU_ICUSTDU)\n#    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's \n#  0.0248   3.4480   8.0820  12.7100  15.8800 153.4000      584 \n\n#Median table for time to first loop in STDU for ICU + STDU:\nTime_loop_STDU_ICUSTDU <- subset(time.to.first.STDU.loop.2,CAT_ICU_AND_STDU.2 == \"1\")\nsummary(Time_loop_STDU_ICUSTDU)\n#    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's \n#  0.0248   3.4480   8.0820  12.7100  15.8800 153.4000      584 \n\n#Freq table for location of ICU loop - ICU only:\nattach(ICU_Official)\nFreq_LOC_ICU <- table(location.of.first.ICU.loop.2,CAT_ICU_NO_STDU.2)\nftable(Freq_LOC_ICU)\n#CAT_ICU_NO_STDU.2                                0   1\n#location.of.first.ICU.loop.2                          \n#1                                               26  56\n#2                                               81 256\n#3                                              150 387\n#4                                              145 198\n#5                                               77  65\n#6                                               27   5\n#7                                                6   0\n\n#Freq table for location of ICU loop - ICU + STDU:\nattach(ICU_Official)\nFreq_LOC_ICUSTDU <- table(location.of.first.ICU.loop.2,CAT_ICU_AND_STDU.2)\nftable(Freq_LOC_ICUSTDU)\n#CAT_ICU_AND_STDU.2                                0   1\n#location.of.first.ICU.loop.2                           \n#1                                                56  26\n#2                                               256  81\n#3                                               387 150\n#4                                               198 145\n#5                                                65  77\n#6                                                 5  27\n#7                                                 0   6\n\n#Median table for #transfers by Discharge Disposition:\n#zDC DEATH zDC FED zDC HHLTH zDC HOME zDC HOSPICE zDC ICF zDC LAMA zDC LAW zDC LTC zDC OTHER zDC PSYU zDC REHAB zDC SNF\n#Frequency       563       7      3263     5742         234       2       61      38       1         8       59       388    1224\n#%                 5       0        28       49           2       0        1       0       0         0        1         3      11\n#zDC STAC zDC SWING\n#Frequency       50         1\n#%                0         0\n\nTransfers_Death <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC DEATH\")\nsummary(Transfers_Death)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#2.000   4.000   5.000   5.038   6.000  16.000 \nTransfers_Fed <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC FED\")\nsummary(Transfers_Fed)\n\nTransfers_HHLTH <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC HHLTH\")\nsummary(Transfers_HHLTH)\n\nTransfers_HOME <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC HOME\")\nsummary(Transfers_HOME)\n\nTransfers_Hospice <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC HOSPICE\")\nsummary(Transfers_Hospice)\n\nTransfers_ICF <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC ICF\")\nsummary(Transfers_ICF)\n\nTransfers_LAMA <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC LAMA\")\nsummary(Transfers_LAMA)\n\nTransfers_LAW <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC LAW\")\nsummary(Transfers_LAW)\n\nTransfers_LTC <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC LTC\")\nsummary(Transfers_LTC)\n\nTransfers_Other <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC OTHER\")\nsummary(Transfers_Other)\n\nTransfers_PSYU <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC PSYU\")\nsummary(Transfers_PSYU)\n\nTransfers_REHAB <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC REHAB\")\nsummary(Transfers_REHAB)\n\nTransfers_SNF <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC SNF\")\nsummary(Transfers_SNF)\n\nTransfers_STAC <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC STAC\")\nsummary(Transfers_STAC)\n\nTransfers_Swing <- subset(Total.transfers,DISCHARGE_DISPOSITION_1.x == \"zDC SWING\")\nsummary(Transfers_Swing)\n\n\n\n#Freq table: median # transfers by pt type, ICU/STDU, etc:\n#Patient type: Linear v Looper:\nTransfers_Linear <- subset(Total.transfers,CAT_LIN_LOOP.2 == 0)\nsummary(Transfers_Linear)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#1.000   3.000   4.000   3.645   4.000   8.000 \nTransfers_Looper <- subset(Total.transfers,CAT_LIN_LOOP.2 == 1)\nsummary(Transfers_Looper)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#2.000   4.000   5.000   5.336   6.000  17.000 \n\n#ICU, STDU, ICU + STDU:\nTransfers_ICU <- subset(Total.transfers,CAT_ICU_NO_STDU.2 == 1)\nsummary(Transfers_ICU)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#1.000   3.000   4.000   3.905   4.000  13.000 \nTransfers_STDU <- subset(Total.transfers,CAT_STDU_ANY.2 == 1)\nsummary(Transfers_STDU)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#--\nTransfers_ICUSTDU <- subset(Total.transfers,CAT_ICU_AND_STDU.2 == 1)\nsummary(Transfers_ICUSTDU)\n#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#2.000   4.000   5.000   5.059   6.000  17.000 \n\n\n#----------------------------------------------------------------------------------------------------------#\n\n\n########################### ICU Only #################################\n\n\nICU_Official <- read.csv(\"ICU_DATA_ANALYSIS_12142015_corr2.csv\",header=TRUE,as.is=TRUE)\n\nICU_VARS_OFFICIAL <- ICU_Official[,names(ICU_Official) %in% c(\"ADMIT_ID\", \"PATIENT_NUM\", \"AGE_ON_ADMISSION\", \n                                                              \"MARITAL_CD\", \"ETHNIC_CD\", \"SEX_CD\", \"GRAND_TOTAL\",\n                                                              \"DISCHARGE_DISPOSITION_1\", \"TOT_LOS\", \"ICU_ADMIT\",\n                                                              \"CAT_ICU_STDU\", \"CAT_STDU\", \"CAT_ICU\", \"CAT_LIN_LOOP\",\n                                                              \"CAT_SURV_FIRST_ICU\", \"CAT_SURV_FIRST_STDU\", \"Total.ICU.Time\")] \n\n#Only looking at ICU\nICU_VARS_OFFICIAL <- subset(ICU_VARS_OFFICIAL,CAT_ICU == \"1\")\n\n#Frequency table - Sex vs. Linear/Looper\nattach(ICU_VARS_OFFICIAL)\nICUfreq_SEX_vs_LINLOOP <- table(SEX_CD,CAT_LIN_LOOP)\nftable(ICUfreq_SEX_vs_LINLOOP)\n#CAT_LIN_LOOP           0    1\n#SEX_CD                       \n#F                    976  295\n#M                   1492  417\n\n#Frequency table - Ethnicity vs. Linear/Looper\nattach(ICU_VARS_OFFICIAL)\nICUfreq_ETHNICITY_vs_LINLOOP <- table(ETHNIC_CD,CAT_LIN_LOOP)\nftable(ICUfreq_ETHNICITY_vs_LINLOOP)\n#CAT_LIN_LOOP              0    1\n#ETHNIC_CD                       \n#AI                        5    1\n#AS                       23   11\n#BL                      265   78\n#MR                        2    2\n#OT                       81   27\n#UN                       13    2\n#WH                     2079  591\n\n#Median table for Total Hospital LOS by Linear/Looper vs. Discharge Disposition:\nattach(ICU_VARS_OFFICIAL)\ntable_DISCHARGE_vs_TOTLOS_vs_LINLOOP <- data.table(DISCHARGE_DISPOSITION_1,TOT_LOS,CAT_LIN_LOOP)\ndata.table(table_DISCHARGE_vs_TOTLOS_vs_LINLOOP)\ndatafile=read.table(table_DISCHARGE_vs_TOTLOS_vs_LINLOOP, header=TRUE)\nmedian_output <- tapply(as.numeric(table_DISCHARGE_vs_TOTLOS_vs_LINLOOP$TOT_LOS), list(table_DISCHARGE_vs_TOTLOS_vs_LINLOOP$DISCHARGE_DISPOSITION, \n                                                           table_DISCHARGE_vs_TOTLOS_vs_LINLOOP$CAT_LIN_LOOP), median)\nmedian_output = data.table(median_output)\n\n#Median table for Total ICU LOS by Linear/Looper vs. Discharge Disposition:\nattach(ICU_VARS_OFFICIAL)\ntable_DISCHARGE_vs_ICULOS_vs_LINLOOP <- data.table(DISCHARGE_DISPOSITION_1,Total.ICU.Time, CAT_LIN_LOOP)\ndata.table(table_DISCHARGE_vs_ICULOS_vs_LINLOOP)\ndatafile=read.table(table_DISCHARGE_vs_ICULOS_vs_LINLOOP, header=TRUE)\nmedian_output2 <- tapply(as.numeric(table_DISCHARGE_vs_ICULOS_vs_LINLOOP$Total.ICU.Time), list(table_DISCHARGE_vs_ICULOS_vs_LINLOOP$DISCHARGE_DISPOSITION, \n                                                                                       table_DISCHARGE_vs_ICULOS_vs_LINLOOP$CAT_LIN_LOOP), median)\nmedian_output2 = data.table(median_output2)\n\n#Median table for Total Cost by Linear/Looper vs. Discharge Disposition:\nattach(ICU_VARS_OFFICIAL)\ntable_DISCHARGE_vs_COST_vs_LINLOOP <- data.table(DISCHARGE_DISPOSITION_1,GRAND_TOTAL, CAT_LIN_LOOP)\ndata.table(table_DISCHARGE_vs_COST_vs_LINLOOP)\ndatafile=read.table(table_DISCHARGE_vs_COST_vs_LINLOOP, header=TRUE)\nmedian_output3 <- tapply(as.numeric(table_DISCHARGE_vs_COST_vs_LINLOOP$GRAND_TOTAL), list(table_DISCHARGE_vs_COST_vs_LINLOOP$DISCHARGE_DISPOSITION, \n                                                                                               table_DISCHARGE_vs_COST_vs_LINLOOP$CAT_LIN_LOOP), median)\nmedian_output3 = data.table(median_output3)\n\n#-------------------------------------------------------------------------------------------\n########################### STDU Only #############################\n\nSTDU_Official <- read.csv(\"ICU_DATA_ANALYSIS_12142015_corr2.csv\",header=TRUE,as.is=TRUE)\n\n#Deleting things we don't need to create dataset ICU_VARS:\nSTDU_VARS_OFFICIAL <- STDU_Official[,names(STDU_Official) %in% c(\"ADMIT_ID\", \"PATIENT_NUM\", \"AGE_ON_ADMISSION\", \n                                                              \"MARITAL_CD\", \"ETHNIC_CD\", \"SEX_CD\", \"GRAND_TOTAL\",\n                                                              \"DISCHARGE_DISPOSITION_1\", \"TOT_LOS\", \"ICU_ADMIT\",\n                                                              \"CAT_ICU_STDU\", \"CAT_STDU\", \"CAT_ICU\", \"CAT_LIN_LOOP\",\n                                                              \"CAT_SURV_FIRST_ICU\", \"CAT_SURV_FIRST_STDU\", \"Total.ICU.Time\")] \n\n#Only looking at STDU\nSTDU_VARS_OFFICIAL <- subset(STDU_VARS_OFFICIAL,CAT_STDU == \"1\")\n\n#Frequency table - Discharge Disposition vs. Linear/Looper\nattach(STDU_VARS_OFFICIAL)\nSTDUfreq_DISCHARGE_vs_LINLOOP <- table(DISCHARGE_DISPOSITION_1,CAT_LIN_LOOP)\nftable(STDUfreq_ETHNICITY_vs_LINLOOP)\n\n#Median table for Total Hospital LOS by Linear/Looper vs. Discharge Disposition:\nattach(STDU_VARS_OFFICIAL)\nSTDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP <- data.table(DISCHARGE_DISPOSITION_1,TOT_LOS,CAT_LIN_LOOP)\ndata.table(STDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP)\ndatafile=read.table(STDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP, header=TRUE)\nmedian_output <- tapply(as.numeric(STDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP$TOT_LOS), list(STDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP$DISCHARGE_DISPOSITION, \n                                                                                       STDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP$CAT_LIN_LOOP), median)\nmedian_output = data.table(median_output)\n\n#Median table for Total Cost by Linear/Looper vs. Discharge Disposition:\nattach(STDU_VARS_OFFICIAL)\nSTDUtable_DISCHARGE_vs_COST_vs_LINLOOP <- data.table(DISCHARGE_DISPOSITION_1,GRAND_TOTAL, CAT_LIN_LOOP)\ndata.table(STDUtable_DISCHARGE_vs_COST_vs_LINLOOP)\ndatafile=read.table(STDUtable_DISCHARGE_vs_COST_vs_LINLOOP, header=TRUE)\nmedian_output3 <- tapply(as.numeric(STDUtable_DISCHARGE_vs_COST_vs_LINLOOP$GRAND_TOTAL), list(STDUtable_DISCHARGE_vs_COST_vs_LINLOOP$DISCHARGE_DISPOSITION, \n                                                                                          STDUtable_DISCHARGE_vs_COST_vs_LINLOOP$CAT_LIN_LOOP), median)\nmedian_output3 = data.table(median_output3)\n\n\n\n#-------------------------------------------------------------------------------------------\n\n########################### ICU + STDU #############################\n\n\n\n\nICU_and_STDU_Official <- read.csv(\"ICU_DATA_ANALYSIS_12142015_corr2.csv\",header=TRUE,as.is=TRUE)\n\n#Deleting things we don't need to create dataset ICU_VARS:\nICU_STDU_VARS <- ICU_and_STDU_Official[,names(STDU_Official) %in% c(\"ADMIT_ID\", \"PATIENT_NUM\", \"AGE_ON_ADMISSION\", \n                                                                 \"MARITAL_CD\", \"ETHNIC_CD\", \"SEX_CD\", \"GRAND_TOTAL\",\n                                                                 \"DISCHARGE_DISPOSITION_1\", \"TOT_LOS\", \"ICU_ADMIT\",\n                                                                 \"CAT_ICU_STDU\", \"CAT_STDU\", \"CAT_ICU\", \"CAT_LIN_LOOP\",\n                                                                 \"CAT_SURV_FIRST_ICU\", \"CAT_SURV_FIRST_STDU\", \"Total.ICU.Time\")] \n\n#Only looking at STDU\nICU_STDU_VARS <- subset(ICU_STDU_VARS,CAT_ICU_STDU == \"1\")\n\n#Frequency table - Discharge Disposition vs. Linear/Looper\nattach(ICU_STDU_VARS)\nICUSTDUfreq_DISCHARGE_vs_LINLOOP <- table(DISCHARGE_DISPOSITION_1,CAT_LIN_LOOP)\nftable(ICUSTDUfreq_DISCHARGE_vs_LINLOOP)\n\n#Median table for Total Hospital LOS by Linear/Looper vs. Discharge Disposition:\nattach(ICU_STDU_VARS)\nICUSTDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP <- data.table(DISCHARGE_DISPOSITION_1,TOT_LOS,CAT_LIN_LOOP)\ndata.table(ICUSTDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP)\ndatafile=read.table(ICUSTDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP, header=TRUE)\nmedian_output <- tapply(as.numeric(ICUSTDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP$TOT_LOS), list(ICUSTDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP$DISCHARGE_DISPOSITION, \n                                                                                              ICUSTDUtable_DISCHARGE_vs_TOTLOS_vs_LINLOOP$CAT_LIN_LOOP), median)\nmedian_output = data.table(median_output)\n\n#Median table for Total ICU LOS by Linear/Looper vs. Discharge Disposition:\nattach(ICU_STDU_VARS)\nICUSTDUtable_DISCHARGE_vs_ICULOS_vs_LINLOOP <- data.table(DISCHARGE_DISPOSITION_1,Total.ICU.Time, CAT_LIN_LOOP)\ndata.table(ICUSTDUtable_DISCHARGE_vs_ICULOS_vs_LINLOOP)\ndatafile=read.table(ICUSTDUtable_DISCHARGE_vs_ICULOS_vs_LINLOOP, header=TRUE)\nmedian_output2 <- tapply(as.numeric(ICUSTDUtable_DISCHARGE_vs_ICULOS_vs_LINLOOP$Total.ICU.Time), list(ICUSTDUtable_DISCHARGE_vs_ICULOS_vs_LINLOOP$DISCHARGE_DISPOSITION, \n                                                                                                      ICUSTDUtable_DISCHARGE_vs_ICULOS_vs_LINLOOP$CAT_LIN_LOOP), median)\nmedian_output2 = data.table(median_output2)\n\n#Median table for Total Cost by Linear/Looper vs. Discharge Disposition:\nattach(ICU_STDU_VARS)\nICUSTDUtable_DISCHARGE_vs_COST_vs_LINLOOP <- data.table(DISCHARGE_DISPOSITION_1,GRAND_TOTAL, CAT_LIN_LOOP)\ndata.table(ICUSTDUtable_DISCHARGE_vs_COST_vs_LINLOOP)\ndatafile=read.table(ICUSTDUtable_DISCHARGE_vs_COST_vs_LINLOOP, header=TRUE)\nmedian_output3 <- tapply(as.numeric(ICUSTDUtable_DISCHARGE_vs_COST_vs_LINLOOP$GRAND_TOTAL), list(ICUSTDUtable_DISCHARGE_vs_COST_vs_LINLOOP$DISCHARGE_DISPOSITION, \n                                                                                              ICUSTDUtable_DISCHARGE_vs_COST_vs_LINLOOP$CAT_LIN_LOOP), median)\nmedian_output3 = data.table(median_output3)\n\n\n\n\n#-------------------------------------------------------------------------------------------------\n\n\n###########################   ICU Analysis   ##################################\n\n\n\n#ICU only\nICU_Only <- subset(ICU_Official,CAT_ICU == \"1\")\n\n\n#Need to look at time in each ICU & cumulative time per stay\n#Use vars:\n#Time.to.first.ICU.stay\n#Total.ICU.Time\n#time.to.first.ICU.loop\n#fraction.of.total.stay.to.first.ICU.loop\n#time.to.complete.first.ICU.loop\n#fraction.of.total.stay.through.end.of.first.ICU.loop\n\n\n# ------------------------------------------------------------------------------------------------------------------------\n\n#############################    Diagnosis Tables   ####################################\n\n\n\n#Freq table for heart attack diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_MI <- table(MI_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_MI) \n#CAT_LIN_LOOP.2    0    1\n#MI_DX                         \n#0                    3071 1301\n#1                     206  178\n\n#Freq table for CHF diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_CHF <- table(CHF_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_CHF)\n#CAT_LIN_LOOP.2    0    1\n#CHF_DX                         \n#0                     2711  990\n#1                      566  489\n\n#Freq table for PVD diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_PVD <- table(VASCUL1_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_PVD)\n#CAT_LIN_LOOP.2    0    1\n#VASCUL1_DX                         \n#0                         2594 1022\n#1                          683  457\n\n#Freq table for CVD diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_CVD <- table(CVD_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_CVD)\n#CAT_LIN_LOOP.2    0    1\n#CVD_DX                         \n#0                     2815 1270\n#1                      462  209\n\n#Freq table for COPD diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_COPD <- table(COPD_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_COPD)\n#CAT_LIN_LOOP.2    0    1\n#COPD_DX                         \n#0                      2869 1217\n#1                       408  262\n\n#Freq table for Asthma diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_Asthma <- table(Asthma_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_Asthma)\n#CAT_LIN_LOOP.2    0    1\n#Asthma_DX                         \n#0                        3023 1369\n#1                         254  110\n\n#Freq table for Lipid metabolism diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_LIPID <- table(LIPID_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_LIPID)\n#CAT_LIN_LOOP.2    0    1\n#LIPID_DX                         \n#0                       2352  984\n#1                        925  495\n\n#Freq table for Diabetes diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_DIAB <- table(DIAB_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_DIAB)\n#CAT_LIN_LOOP.2    0    1\n#DIAB_DX                         \n#0                      2327  926\n#1                       950  553\n\n#Freq table for Renal disease diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_RENAL <- table(RENAL_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_RENAL)\n#CAT_LIN_LOOP.2    0    1\n#RENAL_DX                         \n#0                       2568  933\n#1                        709  546\n\n#Freq table for CKD disease diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_CKD <- table(CKD_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_CKD)\n#CAT_LIN_LOOP.2    0    1\n#CKD_DX                         \n#0                     2868 1151\n#1                      409  328\n\n#Freq table for Liver disease diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_LIVER <- table(LIVER_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_LIVER)\n#CAT_LIN_LOOP.2    0    1\n#LIVER_DX                         \n#0                       3067 1277\n#1                        210  202\n\n#Freq table for HIV diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_HIV <- table(HIV_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_HIV)\n#CAT_LIN_LOOP.2    0    1\n#HIV_DX                         \n#0                     3246 1464\n#1                       31   15\n\n#Freq table for Hep A diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_Hep <- table(Hep_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_Hep)\n#CAT_LIN_LOOP.2    0    1\n#Hep_DX                         \n#0                     3209 1437\n#1                       68   42\n\n#Freq table for Cancer diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_Cancer <- table(CANCER_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_Cancer)\n#CAT_LIN_LOOP.2    0    1\n#CANCER_DX                         \n#0                        2806 1150\n#1                         471  329\n\n#Freq table for Anemia diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_Anemia <- table(Anemia_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_Anemia)\n#CAT_LIN_LOOP.2    0    1\n#Anemia_DX                         \n#0                        2425  884\n#1                         852  595\n\n#Freq table for Coag diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_Coag <- table(Coag_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_Coag)\n#CAT_LIN_LOOP.2    0    1\n#Coag_DX                         \n#0                      3004 1235\n#1                       273  244\n\n#Freq table for ESRD diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_ESRD <- table(ESRD_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_ESRD)\n#CAT_LIN_LOOP.2    0    1\n#ESRD_DX                         \n#0                      3179 1389\n#1                        98   90\n\n#Freq table for malnutrition diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_malnutrition <- table(Malnutrition_Dx,CAT_LIN_LOOP.2)\nftable(freq_dx_malnutrition)\n#CAT_LIN_LOOP.2    0    1\n#Malnutrition_Dx                         \n#0                              3228 1423\n#1                                49   56\n\n#Freq table for Respiratory Failure diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_Resp_Fail <- table(Resp_Fail_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_Resp_Fail)\n#CAT_LIN_LOOP.2    0    1\n#Resp_Fail_DX                         \n#0                           2465  857\n#1                            812  622\n\n#Freq table for Sepsis diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_Sepsis <- table(Sepsis_DX,CAT_LIN_LOOP.2)\nftable(freq_dx_Sepsis)\n#CAT_LIN_LOOP.2    0    1\n#Sepsis_DX                         \n#0                        2807 1038\n#1                         470  441\n\n#Freq table for Vent diagnosis vs. lin/loop:\nattach(ICU_Official)\nfreq_dx_Vent <- table(Vent,CAT_LIN_LOOP.2)\nftable(freq_dx_Vent)\n#CAT_LIN_LOOP.2    0    1\n#Vent                         \n#0                   2740 1043\n#1                    537  436\n\n#Mosaic plot\nattach(ICU_Official)\nFREQ_MOSAIC <- table(Sepsis_DX,CAT_LIN_LOOP.2,CAT_SURV_FIRST_ICU)\ndimnames(FREQ_MOSAIC) <- list(c(\"No Sepsis\",\"Sepsis\"),c(\"Linear\",\"Looper\"),\n                              c(\"Died in 1st ICU\",\"Survived 1st ICU\"))\nmosaicplot(FREQ_MOSAIC, main=\"ICU Mosaic Plot\", shade=TRUE, colorize=TRUE)\n\nattach(ICU_Official)\nFREQ_MOSAIC2 <- table(DIAB_DX,CAT_LIN_LOOP.2,SEX_CD)\ndimnames(FREQ_MOSAIC2) <- list(c(\"No Diabetes\",\"Diabetes\"),c(\"Linear\",\"Looper\"),\n                              c(\"Male\",\"Female\"))\nmosaicplot(FREQ_MOSAIC2, main=\"ICU Mosaic Plot\", shade=TRUE, colorize=TRUE)\n\nattach(ICU_Official)\nFREQ_MOSAIC3 <- table(DIAB_DX, Sepsis_DX, MI_DX, Vent, CAT_LIN_LOOP.2)\ndimnames(FREQ_MOSAIC3) <- list(c(\"No Diabetes\", \"Diabetes\"), c(\"No Sepsis\",\"Sepsis\"),c(\"No MI\", \"MI\"),\n                               c(\"No Vent\",\"Vent\"), c(\"Linear\",\"Looper\"))\nmosaicplot(FREQ_MOSAIC3, main=\"ICU Mosaic Plot\", shade=TRUE, colorize=TRUE)\n\n\n\n#-----------------------------------------------------------------------------------------------------------------------\n\n################################   SURVIVAL ANALYSIS   ###################################\n\n\n#Create new variable for DISCHARGE = DEATH:\nICU_MULT_SUBSET$DC_DEATH <- as.numeric(ICU_Official$DISCHARGE_DISPOSITION_1.x == \"zDC DEATH\")\n\n\n#Initial survival curv - Lin & Loop curve -> Total length of stay (days in hospital) versus Discharge Disp = \"zDC DEATH\"\n#http://stats.stackexchange.com/questions/26247/estimating-a-survival-probability-in-r\n#http://isites.harvard.edu/fs/docs/icb.topic79671.files/survival-lec3-appendix-A.pdf\n\nICU_SURV_2 <- survfit(Surv(TOT_LOS,ICU_MULT_SUBSET$DC_DEATH)~ CAT_LIN_LOOP.2, data=ICU_Official)\n\nplot(ICU_SURV_2, xlab=\"Hospital Length of Stay (days)\", ylab=\"Survival\",\n     cex.lab=1.3, cex.axis=1.3, mark=1,main=\"Kaplan-Meier ICU Survival\",lty=c(1,1),\n     lwd=2,col=c(\"darkblue\",2),bty=\"n\")\nlegend(\"topright\",c(\"Linear\",\"Cyclic\"),lty=c(1,1),col=c(\"darkblue\",2),bty=\"n\",lwd=2)\n\n\n#Plot modifications:\n#RETRY PCH STEP vvv\npch = 1 #should make crosshairs into open circles? but doesn't work...\nconf.int=F,mark.time=F  #remove crosshairs/figures representing patient density\ncex.lab=1.5 #makes axis labels font larger\ncex.axis=1.3 #makes axis numbers font larger\nbty=\"n\" #removes box around entire plot\nlwd=2 #makes lines thicker\ncol=c(\"color1\",\"color2\") #changes color of lines, etc.\nlty=c(1,1) #specifies line type (solid, dashed, dotted, etc.)\n\nICU_SURV_2DIFF <- survdiff(Surv(TOT_LOS,ICU_MULT_SUBSET$DC_DEATH)~ CAT_LIN_LOOP.2, data=ICU_Official)\nICU_SURV_2DIFF\n#Call:\n#  survdiff(formula = Surv(TOT_LOS, ICU_MULT_SUBSET$DC_DEATH) ~ \n#             CAT_LIN_LOOP.2, data = ICU_Official)\n#               N        Observed Expected (O-E)^2/E (O-E)^2/V\n#CAT_LIN_LOOP.2=0 3277      102      132      6.62        13\n#CAT_LIN_LOOP.2=1 1479      210      180      4.83        13\n#Chisq= 13  on 1 degrees of freedom, p= 0.000314 \n\n#ICU_Official$CAT_LIN_LOOP_LINDEATH <- as.numeric(ICU_Official$[[[put in criteria for linears who died\n#                                                                 and make it = 2]]])\n\n\n#-------------------------------------------------------------------------------------\n\n#########################   ADD IN 3RD CURVE TO SURVIVAL ANALYSIS   ##########################\n\n\n#Load dataset:\nsetwd(\"/Volumes/SourceFiles/Data_derived/URMC_ICU_Data/Kristen\")\nICU_Official2 <- read.csv(\"ICU_v4_12312015.csv\",header=TRUE,as.is=TRUE)\n\n#Load Diagnosis Groups:\nICU_Diagnosis <- read.csv(\"ICU_SMH_Diagnosis_Groups_FINAL.csv\",header=TRUE,as.is=TRUE)\n\n#Omit admit IDs of pts that should be excluded bc of pediatric, etc.:\nICU_Official2 <- ICU_Official2[!(ICU_Official2$ADMIT_ID %in% c(468116, 468468, 469467, 470162, 472646, \n                                                            492575, 524961, 545962, 549317, 579127, \n                                                            612553, 613116, 618405, 625733,\n                                                            626499, 666388, 672098, 676640, 686190, \n                                                            686682, 696198, 699524)), ]\n\n#Omit STDU ONLY pts:\nICU_Official2 <- ICU_Official2[!(ICU_Official2$CAT_ICU_ANY.2 == 0),]\n\n#Merge ICU_Official and ICU_Diagnosis:\nICU_Official2 <- merge(ICU_Official2, ICU_Diagnosis, by = \"ADMIT_ID\")\n#Added in extras and diagnosis variables:\n#[663] \"DX_54\"                                                   \"MI_DX\"                                                  \n#[665] \"CHF_DX\"                                                  \"VASCUL1_DX\"                                             \n#[667] \"CVD_DX\"                                                  \"COPD_DX\"                                                \n#[669] \"Asthma_DX\"                                               \"LIPID_DX\"                                               \n#[671] \"DIAB_DX\"                                                 \"RENAL_DX\"                                               \n#[673] \"CKD_DX\"                                                  \"LIVER_DX\"                                               \n#[675] \"HIV_DX\"                                                  \"Hep_DX\"                                                 \n#[677] \"CANCER_DX\"                                               \"Bleeding_DX\"                                            \n#[679] \"Resp_Fail_DX\"                                            \"Sepsis_DX\"                                              \n#[681] \"Vent\"                                                    \"Vent0_96\"                                               \n#[683] \"Vent96\"  \n\n#Create new variable for DISCHARGE = DEATH:\nICU_Official2$DC_DEATH <- as.numeric(ICU_Official2$DISCHARGE_DISPOSITION_1.x == \"zDC DEATH\")\n\n\n#----^^^^---- ALL CUTS MADE EXCEPT FOR THE 620 LINEARS WHO DIED IN 1ST ICU----^^^^----#\n\n#DO NOT RUN v\n#For reference only\n#What we did before to omit the 620 patients who died in their first ICU visit\nICU_Official <- ICU_Official[!(ICU_Official$CAT_SURV_FIRST_ICU.2 == 0 & ICU_Official$CAT_ICU_ANY.2 == 1), ]\n\n\nICU_Officialtry <- ICU_Official2\nICU_Officialtry[ICU_Officialtry$CAT_SURV_FIRST_ICU.2 == 0,\"CAT_LIN_LOOP.2\" ] <- 2\n\n#Now we need to re-run survival analysis with this extra variable in it\nICU_SURV_EXTRA <- survfit(Surv(TOT_LOS,ICU_Officialtry$DC_DEATH)~ CAT_LIN_LOOP.2, data=ICU_Officialtry)\n\n\nfont_import()\n\n\npdf(\"/Users/kristenbush/Desktop/SURV_CURV_final.pdf\",family=\"Arial\")\nplot(ICU_SURV_2, xlab=\"Hospital Length of Stay (days)\", ylab=\"Survival\",\n     cex.lab=1.3, cex.axis=1.3, mark=1,main=\"Kaplan-Meier ICU Survival\",lty=c(1,1),\n     lwd=3,col=c(\"darkblue\",2),bty=\"n\")\nlegend(\"topright\",c(\"Linear\",\"Cyclic\"),lty=c(1,1),col=c(\"darkblue\",2),bty=\"n\",lwd=3)\n\n#Plot with 2 curves & NO tick marks\nplot(ICU_SURV_2, xlab=\"Hospital Length of Stay (days)\", ylab=\"Survival\",\n     cex.lab=1.3, cex.axis=1.3, conf.int=F,mark.time=F,main=\"Kaplan-Meier ICU Survival\",lty=c(1,1),\n     lwd=3,col=c(\"darkblue\",2),bty=\"n\")\nlegend(\"topright\",c(\"Linear\",\"Cyclic\"),lty=c(1,1),col=c(\"darkblue\",2),bty=\"n\",lwd=3)\n\n#Plot with 3 curves & tick marks\nplot(ICU_SURV_EXTRA, xlab=\"Hospital Length of Stay (days)\", ylab=\"Survival\",\n     cex.lab=1.3, cex.axis=1.3, mark=1,main=\"Kaplan-Meier ICU Survival\",lty=c(1,1,1),\n     lwd=3,col=c(\"darkblue\",2,1),bty=\"n\")\nlegend(\"topright\",c(\"Linear\",\"Cyclic\",\"Linears Deceased\"),lty=c(1,1,1),col=c(\"darkblue\",2,1),bty=\"n\",lwd=3)\n\n#Plot with 3 curves & NO tick marks\nplot(ICU_SURV_EXTRA, xlab=\"Hospital Length of Stay (days)\", ylab=\"Survival\",\n     cex.lab=1.3, cex.axis=1.3, onf.int=F,mark.time=F,main=\"Kaplan-Meier ICU Survival\",lty=c(1,1,1),\n     lwd=3,col=c(\"darkblue\",2,1),bty=\"n\")\nlegend(\"topright\",c(\"Linear\",\"Cyclic\",\"Linears Deceased\"),lty=c(1,1,1),col=c(\"darkblue\",2,1),bty=\"n\",lwd=3)\n\ndev.off()\n\n\n#-----------------------------------------------------------------------------------------------------------------------\n\n################################   MULTIVARIATE ANALYSIS   ###################################\n\n\n#Variables:\n#(\"AGE_ON_ADMISSION.x\", \"ETHNIC_CD\", \"SEX_CD\", \"DISCHARGE_DISPOSITION_1.x\", \"TOT_LOS\", \"Total.transfers\",\n#\"Time.to.first.ICU.stay\", \"Total.ICU.Time\", \"Time.to.first.STDU.stay\", \"Total.STDU.Time\", \"time.to.first.ICU.loop\",\n#\"time.to.first.STDU.loop\", \"CAT_LIN_LOOP\", \"CAT_ICU_AND_STDU\", \"CAT_SURV_FIRST_ICU\", \"CAT_SURV_FIRST_STDU\", \n#\"MI_DX\", \"VASCUL1_DX\", \"COPD_DX\", \"LIPID_DX\", \"RENAL_DX\", \"ESRD_DX\", \"HIV_DX\", \"CANCER_DX\", \"Coag_DX\", \"Sepsis_DX\",\n#\"Vent\", \"CHF_DX\", \"CVD_DX\", \"Asthma_DX\", \"DIAB_DX\", \"CKD_DX\", \"LIVER_DX\", \"Hep_DX\", \"Anemia_DX\", \"Resp_Fail_DX\",\n#\"Malnutrition_Dx\")\n\n#Create subset with variables we need:\nICU_MULT_SUBSET <- ICU_Official[,names(ICU_Official) %in% c(\"AGE_ON_ADMISSION.x\", \"DISCHARGE_DISPOSITION_1.x\",\n                                                            \"TOT_LOS\", \"Total.transfers\",\n                                                            \"Time.to.first.ICU.stay\", \"Total.ICU.Time\", \n                                                            \"Time.to.first.STDU.stay\", \"Total.STDU.Time\", \n                                                            \"time.to.first.ICU.loop\", \"time.to.first.STDU.loop\", \n                                                            \"CAT_LIN_LOOP\",  \n                                                            \"MI_DX\", \"VASCUL1_DX\", \"COPD_DX\", \n                                                            \"LIPID_DX\", \"RENAL_DX\", \"ESRD_DX\", \"HIV_DX\", \"CANCER_DX\", \n                                                            \"Coag_DX\", \"Sepsis_DX\", \"Vent\", \"CHF_DX\", \"CVD_DX\", \n                                                            \"Asthma_DX\", \"DIAB_DX\", \"CKD_DX\", \"LIVER_DX\", \"Hep_DX\", \n                                                            \"Anemia_DX\", \"Resp_Fail_DX\", \"Malnutrition_Dx\")]\n\n#Create new variable for DISCHARGE = DEATH:\nICU_MULT_SUBSET$DC_DEATH <- as.numeric(ICU_Official$DISCHARGE_DISPOSITION_1.x == \"zDC DEATH\")\n\n#Omit variables that won't qualify\nICU_MULT_SUBSET_3 <- ICU_MULT_SUBSET[,-2]\n\n#Summary statistics for subset:\nsapply(ICU_MULT_SUBSET[2:38],mean,na.rm=TRUE)\nsapply(ICU_MULT_SUBSET[2:38],sd,na.rm=TRUE)\n\n#Principal Component Analysis\n#Standardize the variables\nstandardisedconcentrations <- as.data.frame(scale(ICU_MULT_SUBSET_3))\n\n\n#split up to quanti and quali datasets\nICU_QUANTI <- standardisedconcentrations[,names(standardisedconcentrations) %in% c(\"AGE_ON_ADMISSION.x\",\n                                                            \"TOT_LOS\", \"Total.transfers\",\n                                                                                   \"Time.to.first.ICU.stay\", \"Total.ICU.Time\", \n                                                                                   \"Time.to.first.STDU.stay\", \"Total.STDU.Time\", \n                                                                                   \"time.to.first.ICU.loop\", \"time.to.first.STDU.loop\")]\n\nICU_QUALI <- standardisedconcentrations[,names(standardisedconcentrations) %in% c(\"CAT_LIN_LOOP\",  \n                                                                                  \"MI_DX\", \"VASCUL1_DX\", \"COPD_DX\", \n                                                                                  \"LIPID_DX\", \"RENAL_DX\", \"ESRD_DX\", \"HIV_DX\", \"CANCER_DX\", \n                                                                                  \"Coag_DX\", \"Sepsis_DX\", \"Vent\", \"CHF_DX\", \"CVD_DX\", \n                                                                                  \"Asthma_DX\", \"DIAB_DX\", \"CKD_DX\", \"LIVER_DX\", \"Hep_DX\", \n                                                                                  \"Anemia_DX\", \"Resp_Fail_DX\", \"Malnutrition_Dx\",\"DC_DEATH\")]\n\n\nICU_FACT_QUALI <- ICU_QUALI\nfor (j in 1:ncol(ICU_QUALI)){\nICU_FACT_QUALI[,j] <- factor(ICU_QUALI[,j])\n}#\nICU_PCA_MIX <- PCAmix(ICU_QUANTI, ICU_FACT_QUALI,ndim=5)\n#Alternative:\nICU_PCA <- prcomp(na.omit(standardisedconcentrations), center=TRUE)\nsummary(ICU_PCA)\n\nPC4 <- ICU_PCA$rotation[,c(1,2,3,4)]\nprint(PC4)\n\nnewdata <- ICU_PCA$x[,c(1,2,3,4)]\nnewdata <- as.matrix(standardisedconcentrations)%*%PC4\n#View PCA\nICU_PCA_MIX$sqload\n#                             dim1         dim2         dim3        dim4         dim5\n#AGE_ON_ADMISSION.x      2.551735e-02 2.061004e-01 1.136865e-01 0.008114554 1.160529e-08\n#TOT_LOS                 5.769838e-01 1.327023e-01 8.237648e-02 0.009712053 1.054171e-02\n#Total.transfers         2.070679e-01 2.052890e-04 6.651628e-03 0.283129223 1.470475e-01\n#Time.to.first.ICU.stay  1.706948e-01 1.371120e-01 3.252001e-01 0.027281044 1.096505e-01\n#Total.ICU.Time          3.398434e-01 4.010742e-02 6.853657e-05 0.059686397 1.655080e-02\n#Time.to.first.STDU.stay 9.919878e-02 7.730337e-02 1.510551e-02 0.001354455 1.495829e-01\n#Total.STDU.Time         7.993237e-02 5.382751e-02 1.199858e-04 0.005625281 4.348686e-02\n#time.to.first.ICU.loop  2.229360e-01 2.561455e-01 2.826693e-01 0.068379636 6.023964e-05\n#time.to.first.STDU.loop 1.004797e-01 1.486206e-01 1.631832e-02 0.024432237 2.237059e-01\n#CAT_LIN_LOOP            2.164628e-01 1.307299e-02 2.722921e-04 0.200213764 1.820182e-01\n#MI_DX                   2.200777e-02 1.184028e-01 1.289874e-02 0.005293407 2.341683e-03\n#CHF_DX                  1.601535e-01 1.462474e-01 5.339401e-02 0.005244200 2.952089e-03\n#VASCUL1_DX              6.552792e-02 8.354787e-02 1.319841e-02 0.001041962 4.985989e-04\n#CVD_DX                  4.022430e-06 4.735598e-03 2.810157e-02 0.055018625 8.241423e-04\n#COPD_DX                 3.846681e-02 7.410872e-02 1.721311e-02 0.005424655 1.053576e-02\n#Asthma_DX               7.813019e-04 1.007128e-03 1.012970e-02 0.008116853 3.899698e-02\n#LIPID_DX                1.292612e-02 2.387454e-01 1.454375e-01 0.003038309 1.583061e-02\n#DIAB_DX                 4.547029e-02 1.908298e-01 3.244054e-02 0.043378958 1.901682e-02\n#RENAL_DX                3.079337e-01 6.910606e-02 2.400080e-02 0.051944284 1.037310e-03\n#CKD_DX                  1.437046e-01 1.737869e-01 4.948203e-03 0.081440048 1.665160e-05\n#ESRD_DX                 4.981508e-02 1.696966e-02 1.377647e-03 0.032319797 1.106424e-03\n#LIVER_DX                1.306967e-01 1.757831e-03 1.270797e-01 0.117743359 4.483071e-02\n#HIV_DX                  2.127701e-03 5.256023e-03 4.188828e-02 0.027654313 4.703357e-02\n#Hep_DX                  1.512211e-02 7.321726e-03 9.414031e-02 0.084307287 4.609603e-02\n#CANCER_DX               5.578908e-02 1.277997e-02 8.898942e-04 0.001067427 4.908054e-03\n#Anemia_DX               2.235496e-01 1.165499e-02 5.678845e-02 0.048281983 7.011837e-03\n#Coag_DX                 1.391774e-01 7.011488e-04 7.622755e-02 0.066264408 1.530410e-02\n#Resp_Fail_DX            2.814395e-01 1.476655e-02 7.913920e-02 0.059042310 9.304309e-02\n#Sepsis_DX               2.606359e-01 5.261513e-04 9.382663e-02 0.001022237 1.434309e-03\n#Malnutrition_Dx         8.093478e-02 2.900767e-03 6.528142e-02 0.017114525 5.927489e-03\n#Vent                    1.868200e-01 4.992163e-05 7.946692e-02 0.096100809 8.896682e-02\n\nPCA_Stats <- ICU_PCA_MIX$sqload\nPCA_Stats_Table <- as.data.table(PCA_Stats)\nwrite.csv(PCA_Stats_Table, file = \"PCA_Stats.csv\")\nprint(PCA_Stats_Table)\n\n#Create a screeplot of continuous variables:\nscreeplot(ICU_PCA, type=\"lines\")\n\n#Incorporate in the binary variables?\n\n#Run the analysis\n\n#--------------------------------------------------------------------------------------\n\n\n#Miscellaneous for Robert\nICU_ADMIT <- ICU_Official[,names(ICU_Official) %in% c(\"ADMIT_ID\")]\nwrite.csv(ICU_ADMIT, file=\"Downloads/ICU_ADMIT\")\n\nSMH_INDEX_Dx <- subset(ICU_Official, select = c(ADMIT_ID, AGE_ON_ADMISSION.x\n                                                   ,DISCHARGE_DISPOSITION_1.x, DIAGNOSES_01, DIAGNOSES_02\n                                                   ,DIAGNOSES_03,DIAGNOSES_04, DIAGNOSES_05, DIAGNOSES_06\n                                                   ,DIAGNOSES_07,DIAGNOSES_08, DIAGNOSES_09, DIAGNOSES_10\n                                                   ,DIAGNOSES_11,DIAGNOSES_12, DIAGNOSES_13, DIAGNOSES_14\n                                                   ,DIAGNOSES_15,DIAGNOSES_16, DIAGNOSES_17, DIAGNOSES_18\n                                                   ,DIAGNOSES_19,DIAGNOSES_20, DIAGNOSES_21, DIAGNOSES_22\n                                                   ,DIAGNOSES_23,DIAGNOSES_24, DIAGNOSES_25, DIAGNOSES_26\n                                                   ,DIAGNOSES_27,DIAGNOSES_28, DIAGNOSES_29, DIAGNOSES_30\n                                                   ,DIAGNOSES_31,DIAGNOSES_32, DIAGNOSES_33, DIAGNOSES_34\n                                                   ,DIAGNOSES_35,DIAGNOSES_36, DIAGNOSES_37, DIAGNOSES_38\n                                                   ,DIAGNOSES_39,DIAGNOSES_40, DIAGNOSES_41, DIAGNOSES_42\n                                                   ,DIAGNOSES_43,DIAGNOSES_44, DIAGNOSES_45, DIAGNOSES_46\n                                                   ,DIAGNOSES_47,DIAGNOSES_48, DIAGNOSES_49, DIAGNOSES_50\n                                                   ,DIAGNOSES_51,DIAGNOSES_52, DIAGNOSES_53, DIAGNOSES_54\n                                                   ))\n\nSMH_INDEX_Dx$DX_1 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_01)\nSMH_INDEX_Dx$DX_2 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_02)\nSMH_INDEX_Dx$DX_3 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_03)\nSMH_INDEX_Dx$DX_4 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_04)\nSMH_INDEX_Dx$DX_5 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_05)\nSMH_INDEX_Dx$DX_6 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_06)\nSMH_INDEX_Dx$DX_7 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_07)\nSMH_INDEX_Dx$DX_8 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_08)\nSMH_INDEX_Dx$DX_9 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_09)\nSMH_INDEX_Dx$DX_10 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_10)\nSMH_INDEX_Dx$DX_11 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_11)\nSMH_INDEX_Dx$DX_12 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_12)\nSMH_INDEX_Dx$DX_13 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_13)\nSMH_INDEX_Dx$DX_14 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_14)\nSMH_INDEX_Dx$DX_15 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_15)\nSMH_INDEX_Dx$DX_16 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_16)\nSMH_INDEX_Dx$DX_17 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_17)\nSMH_INDEX_Dx$DX_18 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_18)\nSMH_INDEX_Dx$DX_19 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_19)\nSMH_INDEX_Dx$DX_20 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_20)\nSMH_INDEX_Dx$DX_21 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_21)\nSMH_INDEX_Dx$DX_22 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_22)\nSMH_INDEX_Dx$DX_23 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_23)\nSMH_INDEX_Dx$DX_24 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_24)\nSMH_INDEX_Dx$DX_25 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_25)\nSMH_INDEX_Dx$DX_26 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_26)\nSMH_INDEX_Dx$DX_27 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_27)\nSMH_INDEX_Dx$DX_28 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_28)\nSMH_INDEX_Dx$DX_29 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_29)\nSMH_INDEX_Dx$DX_30 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_30)\nSMH_INDEX_Dx$DX_31 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_31)\nSMH_INDEX_Dx$DX_32 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_32)\nSMH_INDEX_Dx$DX_33 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_33)\nSMH_INDEX_Dx$DX_34 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_34)\nSMH_INDEX_Dx$DX_35 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_35)\nSMH_INDEX_Dx$DX_36 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_36)\nSMH_INDEX_Dx$DX_37 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_37)\nSMH_INDEX_Dx$DX_38 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_38)\nSMH_INDEX_Dx$DX_39 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_39)\nSMH_INDEX_Dx$DX_40 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_40)\nSMH_INDEX_Dx$DX_41 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_41)\nSMH_INDEX_Dx$DX_42 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_42)\nSMH_INDEX_Dx$DX_43 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_43)\nSMH_INDEX_Dx$DX_44 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_44)\nSMH_INDEX_Dx$DX_45 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_45)\nSMH_INDEX_Dx$DX_46 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_46)\nSMH_INDEX_Dx$DX_47 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_47)\nSMH_INDEX_Dx$DX_48 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_48)\nSMH_INDEX_Dx$DX_49 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_49)\nSMH_INDEX_Dx$DX_50 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_50)\nSMH_INDEX_Dx$DX_51 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_51)\nSMH_INDEX_Dx$DX_52 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_52)\nSMH_INDEX_Dx$DX_53 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_53)\nSMH_INDEX_Dx$DX_54 <- sub(\"\\\\.\", \"\", SMH_INDEX_Dx$DIAGNOSES_54)\n\nSMH_INDEX_Dx <- SMH_INDEX_Dx[,!names(SMH_INDEX_Dx) %in% c(\"DIAGNOSES_01\",\"DIAGNOSES_02\",\"DIAGNOSES_03\"\n                                                          ,\"DIAGNOSES_04\",\"DIAGNOSES_05\",\"DIAGNOSES_06\"\n                                                          ,\"DIAGNOSES_07\",\"DIAGNOSES_08\",\"DIAGNOSES_09\"\n                                                          ,\"DIAGNOSES_10\",\"DIAGNOSES_11\",\"DIAGNOSES_12\"\n                                                          ,\"DIAGNOSES_13\",\"DIAGNOSES_14\",\"DIAGNOSES_15\"\n                                                          ,\"DIAGNOSES_16\" ,\"DIAGNOSES_17\",\"DIAGNOSES_18\"\n                                                          ,\"DIAGNOSES_19\",\"DIAGNOSES_20\",\"DIAGNOSES_21\"\n                                                          ,\"DIAGNOSES_22\",\"DIAGNOSES_23\",\"DIAGNOSES_24\"\n                                                          ,\"DIAGNOSES_25\",\"DIAGNOSES_26\",\"DIAGNOSES_27\"\n                                                          ,\"DIAGNOSES_28\",\"DIAGNOSES_29\",\"DIAGNOSES_30\"\n                                                          ,\"DIAGNOSES_31\",\"DIAGNOSES_32\",\"DIAGNOSES_33\"\n                                                          ,\"DIAGNOSES_34\",\"DIAGNOSES_35\",\"DIAGNOSES_36\"\n                                                          ,\"DIAGNOSES_37\",\"DIAGNOSES_38\",\"DIAGNOSES_39\"\n                                                          ,\"DIAGNOSES_40\" ,\"DIAGNOSES_41\",\"DIAGNOSES_42\"\n                                                          ,\"DIAGNOSES_43\" ,\"DIAGNOSES_44\",\"DIAGNOSES_45\"\n                                                          ,\"DIAGNOSES_46\",\"DIAGNOSES_47\",\"DIAGNOSES_48\"\n                                                          ,\"DIAGNOSES_49\" ,\"DIAGNOSES_50\",\"DIAGNOSES_51\"\n                                                          ,\"DIAGNOSES_52\",\"DIAGNOSES_53\",\"DIAGNOSES_54\")]\n\nSMH_INDEX_Dx_new <- subset(SMH_INDEX_Dx, select = c(ADMIT_ID,AGE_ON_ADMISSION.x,DX_1,DX_2\n                                                    ,DX_3,DX_4,DX_5,DX_6,DX_7,DX_8\n                                                    ,DX_9,DX_10,DX_11,DX_12,DX_13,DX_14\n                                                    ,DX_15,DX_16,DX_17,DX_18,DX_19,DX_20\n                                                    ,DX_21,DX_22,DX_23,DX_24,DX_25,DX_26\n                                                    ,DX_27,DX_28,DX_29,DX_30,DX_31,DX_32\n                                                    ,DX_33,DX_34,DX_35,DX_36,DX_37,DX_38\n                                                    ,DX_39,DX_40,DX_41,DX_42,DX_43,DX_44\n                                                    ,DX_45,DX_46,DX_47,DX_48,DX_49,DX_50                  \n                                                    ,DX_51,DX_52,DX_53,DX_54))\n\n\n\ncolnames(SMH_INDEX_Dxs_new)\nSMH_INDEX_Dx_new2 <- SMH_INDEX_Dx_new %>% gather(attribute, value, (c(DX_1,DX_2\n                                                                      ,DX_3,DX_4,DX_5,DX_6,DX_7,DX_8\n                                                                      ,DX_9,DX_10,DX_11,DX_12,DX_13,DX_14\n                                                                      ,DX_15,DX_16,DX_17,DX_18,DX_19,DX_20\n                                                                      ,DX_21,DX_22,DX_23,DX_24,DX_25,DX_26\n                                                                      ,DX_27,DX_28,DX_29,DX_30,DX_31,DX_32\n                                                                      ,DX_33,DX_34,DX_35,DX_36,DX_37,DX_38\n                                                                      ,DX_39,DX_40,DX_41,DX_42,DX_43,DX_44\n                                                                      ,DX_45,DX_46,DX_47,DX_48,DX_49,DX_50                  \n                                                                      ,DX_51,DX_52,DX_53,DX_54)))\n\nDX_FREQ = table(SMH_INDEX_Dx_new2$value)\nDX_FREQ\nFREQ_TABLE = as.data.frame(DX_FREQ)\nFREQ_TABLE\nnames(FREQ_TABLE)[1] = 'DIAGS'\nFREQ_TABLE\nattach(FREQ_TABLE)\nDX_TABLE <- FREQ_TABLE[order(-Freq),]\nDX_TABLE\n\n\n\n\n#_____________________________________________________________________________________________________\n\n\n###########################   RE-CLASSIFY DIAGNOSIS GROUPS   ################################\n\n\n\n# Group RENAL and CKD together in one group:\nsetDT(ICU_Official)\nICU_Official[ , RENAL_DX := apply(.SD, 1, function(x) +any(x %in% c(\"5800\", \"5804\", \"58081\", \"58089\", \"5809\", \"5810\", \"5811\", \"5812\", \"5813\"\n                                                                    , \"58181\", \"58189\", \"5819\", \"5820\", \"5821\", \"5822\", \"5824\", \"58281\", \"58289\"\n                                                                    , \"5829\", \"5830\", \"5831\", \"5832\", \"5834\", \"5836\", \"5837\", \"58381\", \"58389\"\n                                                                    , \"5839\", \"587\", \"5845\", \"5846\", \"5847\", \"5848\", \"5849\", \"586\",\n                                                                    \"585\", \"5851\", \"5852\", \"5853\", \"5854\", \"5855\", \"5859\", \"7925\", \"V451\"\n                                                                    , \"V4511\", \"V4512\", \"V560 \", \"V561 \", \"V562 \", \"V5631\", \"V5632\", \"V568\")))]\n\n# Group HEPATITIS and LIVER DISEASE together in one group:\nsetDT(ICU_Official)\nICU_Official[ , LIVER_DX := apply(.SD, 1, function(x) +any(x %in% c(\"5715\", \"5720\", \"5721\", \"5722\", \"5723\", \"5724\", \"5728\"\n                                                                    , \"5735\", \"7895\", \"78959\", \"570\", \"5716\", \"5718\", \"5719\"\n                                                                    , \"5730\", \"5734\", \"5738\", \"5739\", \"7824\", \"7891\", \"7904\"\n                                                                    , \"7905\", \"7948\", \"V427\", \"0700\", \"0701\", \"0702\", \"07020\", \"07021\", \"07022\"\n                                                                    , \"07023\", \"0703\", \"07030\", \"07031\", \"07032\", \"07033\"\n                                                                    , \"0704\", \"07041\", \"07042\", \"07043\", \"07044\", \"07049\"\n                                                                    , \"0705\", \"07051\", \"07052\", \"07053\", \"07054\", \"07059\"\n                                                                    , \"0706\", \"07070\", \"07071\", \"0709\", \"07271\", \"57140\"\n                                                                    , \"57141\", \"57142\", \"57149\", \"5731\", \"5732\", \"5733\")))]\n\n\n\n# Diagnosis re-groupings:\n\n# Acute heart failure:\nsetDT(ICU_Official)\nICU_Official[ , Acute_HF_DX := apply(.SD, 1, function(x) +any(x %in% c(\"42820\",\"42821\",\"42823\",\"42830\",\"42831\",\"42841\"\n                                                                       ,\"42843\",\"4289\")))]\n\n# Chronic heart failure:\nsetDT(ICU_Official)\nICU_Official[ , CHF_DX := apply(.SD, 1, function(x) +any(x %in% c(\"42822\",\"42832\",\"42840\"\n                                                                  ,\"42842\",\"4280\",\"428\",\"39891\")))]\n\n# Acute kidney injury\nsetDT(ICU_Official)\nICU_Official[ , ACUTE_KIDNEY_DX := apply(.SD, 1, function(x) +any(x %in% c(\"5800\", \"5804\", \"58081\", \"58089\",\"5809\"\n                                                                           , \"5845\", \"5846\", \"5847\", \"5848\"\n                                                                           , \"5849\", \"586\")))]\n\n# Chronic kidney disease\nsetDT(ICU_Official)\nICU_Official[ , CKD_ESRD_DX := apply(.SD, 1, function(x) +any(x %in% c(\"5820\", \"5821\", \"5822\", \"5824\", \"58281\", \"58289\"\n                                                                       , \"5829\", \"5830\", \"5831\", \"5832\", \"5834\", \"5836\"\n                                                                       , \"5837\", \"58381\", \"58389\", \"5839\", \"587\", \"5851\"\n                                                                       , \"5852\", \"5853\", \"5854\", \"5855\", \"5859\", \"7925\"\n                                                                       , \"V451\", \"V4511\", \"V4512\", \"V560\", \"V561\", \"V562\"\n                                                                       , \"V5631\", \"V5632\", \"V568\", \"5856\", \"V420\")))]\n\n# Vent < 96 hours\nsetDT(ICU_Official)\nICU_Official[ , Vent_less_96 := apply(.SD, 1, function(x) +any(x %in% c(\"96.71\")))]\n\n# Vent > 96 hours\nsetDT(ICU_Official)\nICU_Official[ , Vent_more_96 := apply(.SD, 1, function(x) +any(x %in% c(\"96.72\")))]\n\n\n\n\n",
    "created" : 1480106567729.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3456050273",
    "id" : "E61B102D",
    "lastKnownWriteTime" : 1455221507,
    "path" : "~/Desktop/ICU Paper/Kristen_Code.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}